# Stylished Water

## Animation

### Flow

ğŸ“uvåç§»åŠ¨ç”»

uv+_Time.yï¼šç®€å•åœ°æ²¿å¯¹è§’çº¿æ–¹å‘è¿åŠ¨ï¼›

é‡‡æ ·flow mapæ”¹å˜uvåç§»æ–¹å‘ï¼Œ[è¿™é‡Œ](https://catlikecoding.com/unity/tutorials/flow/texture-distortion/seamless-looping/flowmap.png)ï¼ŒRGé€šé“åˆ†åˆ«å­˜æ”¾UVæ–¹å‘ä¿¡æ¯ It contains multiple clockwise and counterclockwise rotating flows, without any sources or sinksã€‚

çº¹ç†çš„é‡‡æ ·æ˜¯å‘¨æœŸå‡½æ•°

<img src="notes/water/1.jpg" alt="IMG_2658" style="zoom: 33%;" />

ç®€å•çš„å‘¨æœŸå‡½æ•°ï¼Œfrac(_Time.y)ï¼Œæˆªæ–­å°æ•°ã€‚

é—®é¢˜ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œ1åˆ°0çš„çªå˜ä½¿å¾—è§†è§‰ä¸Šä¸è¿ç»­ï¼Œå…¶ä»–çš„å‘¨æœŸå‡½æ•°æ¯”å¦‚abs(sin)ä¹Ÿæ— æ³•å¹³æ»‘è¿‡åº¦ï¼ˆæ¥å›éœ‡è¡~~åå¤æ¨ªè·³~~ï¼‰ã€‚å‘¨æœŸæ€§æ˜¯æ— æ³•æ¶ˆé™¤çš„ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡è®¾ç½®ä¸€ä¸ªæƒé‡â€œ**éšè—**â€è¿™ç§ä¸è¿ç»­ã€‚

æƒé‡å‡½æ•°å–ä¸‰è§’æ³¢å°±å¯1-|1-2t|ï¼Œå› ä¸ºä¸‰è§’å‡½æ•°æ•ˆæœæœªå¿…æ›´å¥½ï¼Œä½†è®¡ç®—é‡æ›´å¤§ï¼›éšè—äº†ä¸è¿ç»­ï¼Œä½†åŒæ—¶å¸¦æ¥äº†æ–°é—®é¢˜ï¼Œæ·¡å‡ºæ—¶ä¼šå˜é»‘ï¼ˆå½’0ï¼‰ï¼Œä¾ç„¶æ˜¾å¾—çªå…€ï¼›

å¯ä»¥å¼•å…¥ä¸€ä¸ªæ—¶é—´åç§»é‡ï¼Œæ·¡å‡ºæ—¶ä»ç„¶ä¼šå˜é»‘ï¼Œä½†æ˜¯éšæœºæ€§å¢åŠ äº†ï¼›å†å¼•å…¥å¦ä¸€ä¸ªæ³¢ï¼Œä¸€ä¸ªæ·¡å…¥æ—¶å¦ä¸€ä¸ªæ·¡å‡ºï¼Œæœ€ç»ˆå¯ä»¥æ¶ˆé™¤æ‰é»‘è‰²ã€‚[è¿™é‡Œ](https://catlikecoding.com/unity/tutorials/flow/texture-distortion/seamless-looping/flowmap.png)æ˜¯ä¸€å¼ flow map,rgé€šé“ä¸ºuvåç§»æ–¹å‘ï¼Œaé€šé“ä¸ºæ—¶é—´å™ªéŸ³ã€‚

<img src="notes/water/2.png" alt="ç¬”è®° 2022å¹´3æœˆ14æ—¥ (2)" style="zoom: 25%;" />

```c
// Shader "Costumn/Water"           
float3 gatFlowUVW (float2 uv, bool flowB) { 
                float phaseOffset = flowB ? 0.5 : 0;
                float2 jump = float2(_UJump, _VJump);
                float3 uvw;
                
                float4 color = SAMPLE_TEXTURE2D(_FlowMap, sampler_FlowMap, uv)* _Strength;
                float2 dir = color.rg * 2 - 1;
                float timeOffset = color.a;

                float time=frac((_Time.y * _Speed + timeOffset)  + phaseOffset);
                uvw.xy =uv - dir * time + phaseOffset;  
                uvw.z = 1 - abs(1 - 2 * time);
                return uvw;
            }
...
  float3 uvwA=gatFlowUVW(input.uv,true);
                float3 uvwB=gatFlowUVW(input.uv,false);
                float4 albedo=SAMPLE_TEXTURE2D(_MainTex,sampler_MainTex,uvwA.xy)* uvwA.z;
                float4 albedo2=SAMPLE_TEXTURE2D(_MainTex,sampler_MainTex,uvwB.xy)* uvwB.z;
...
```

åœˆåœˆçŠ¶è¿˜æ˜¯æ¯”è¾ƒæ˜æ˜¾ï¼Œä¸¤ä¸ªæ³¢çš„å‘¨æœŸæ€§

We could simply slide the UV coordinates based on time, but that would cause the whole animation to slide, introducing a directional bias.We can avoid visual sliding by keeping the UV offset constant during each phase, and jumping to a new offset between phases. 

```c
                uvw.xy += ((_Time.y * _Speed + timeOffset)  - time) * jump;                

```

ã€é”¯é½¿TAA?è¿˜æ˜¯DTX1å‹ç¼©æ ¼å¼çº¹ç†ã€‘

<img src="notes/water/temp1.png" alt="image-20220314015726800" style="zoom:50%;" />

<center>ä¸åŠ¨çš„æ—¶å€™æ°´çš„åŠ¨ç”»è¿˜æŒºçœŸçš„</center>

### Wave

ğŸ“é¡¶ç‚¹åç§»åŠ¨ç”»

å†å¦å¤–ä¸€ä¸ªshaderé‡Œç®€å•å°è¯•äº†ä¸€ä¸‹sinæµ·æµª

<img src="notes/water/æœªå‘½åå›¾ç‰‡.png" alt="æœªå‘½åå›¾ç‰‡" style="zoom:50%;" />

<center>é™¤äº†æœ‰ç‚¹å‡çš„åœ°æ–¹éƒ½æŒºçœŸçš„</center>



## Water Surface/Texturing

åªè®¡ç®—äº†p b rçš„è²æ¶…å°”é¡¹

ã€ï¼Ÿè§†å·®è´´å›¾æ¯”æ³•çº¿è´´å›¾å¥½ï¼Œé«˜ä½å‚å·®vsæ–¹å‘ã€‘



## Underwater & Fog

å…‰åœ¨ã€å‡åŒ€ä»‹è´¨ã€‘ï¼ˆå¯†åº¦ç›¸åŒï¼Œå¯ä»¥è®©å…‰æŸç›´çº¿ç©¿å°„è¿‡çš„ ï¼‰ä¸­ä¼ æ’­è¢«å¸æ”¶çš„ç°è±¡ï¼Œ

<img src="notes/water/depth.png" alt="depth"  />

<center>åŸç†æ˜¯æ°´é¢ï¼ˆé€æ˜å±‚ï¼‰ä¸å†™å…¥æ·±åº¦ç¼“å­˜ã€‚</center>

```c

```



## Reflection

æ°´é¢æ¯”è¾ƒé€‚åˆå¹³é¢åå°„ï¼Œ?ç›´æ¥ä½œä¸ºé—´æ¥å…‰æºã€‚



## Refraction

ã€caustics ã€‘

æŠ˜å°„å’Œåå°„ä¸€æ ·ä¹Ÿæœ‰å±€éƒ¨ç®—æ³•ã€å…¨å±€ç®—æ³•å’Œå±å¹•ç©ºé—´ç®—æ³•ã€‚

è¿™é‡Œæ˜¯å±å¹•ç©ºé—´ç®—æ³•ï¼Œåªæ˜¯è§†è§‰ä¸Šçš„è¿‘ä¼¼ï¼Œå¹¶ä¸ç¬¦åˆç‰©ç†è§„å¾‹ï¼š

URPé‡Œå·²ç»æ²¡æœ‰grabPassï¼Œéœ€è¦å¼€å¯color textureï¼Œ_CameraOpaqueTextureé€æ˜ç‰©ä½“æ¸²æŸ“å®Œæˆä¹‹åçš„æˆªå›¾ã€‚é‡‡æ ·æ—¶ï¼Œæ ¹æ®æ³•çº¿è¿›è¡Œçº¹ç†åç§»ï¼Œæ°´æ³¢è¶Šé«˜çš„åœ°æ–¹ï¼Œåç§»è¶Šå¤§ã€‚æŠ˜å°„ä¼šéšç€æ³•çº¿è¿åŠ¨ã€‚

å¯ä»¥æ³¨æ„åˆ°ç‰©ä½“é™„è¿‘ã€æ°´é¢ä¸Šä¹Ÿä¼šæœ‰ä¸åº”è¯¥å‡ºç°çš„åç§»ã€‚

æ·±åº¦å°äº0æ—¶ï¼Œåç§»é‡å–0ï¼Œé‡æ–°é‡‡æ ·ã€‚

![3](notes/water/3.png)

<center>è¾¹ç¼˜ä¼šæœ‰é‡‡æ ·ç²¾åº¦é—®é¢˜</center>

```c

```

<img src="/Users/olirt/Desktop/å±å¹•å¿«ç…§ 2022-03-13 ä¸‹åˆ9.30.28.png" alt="å±å¹•å¿«ç…§ 2022-03-13 ä¸‹åˆ9.30.28" style="zoom:50%;" />

## Foam

åŸºäºæ·±åº¦å·®çš„ç™½æ²«

åŸç†åŒä¸Šï¼šæœ‰ç‰©ä½“å­˜åœ¨æ—¶ï¼ˆåŒ…æ‹¬æ¥è¿‘å²¸è¾¹æ—¶ï¼‰ï¼Œæ°´é¢ã€æ°´åº•çš„æ·±åº¦å·®ä¼šå˜å°ï¼Œè¿™æ ·çš„åœ°æ–¹ä¼šå­˜åœ¨ç™½æ²«ã€‚

```c
		// åŒä¸Šï¼Œdepthæ˜¯æ°´é¢åˆ°æ°´åº•çš„è·ç¦»        
		half4 foamMask =1 - saturate(_FoamThickness* depth);
...

```

ç™½æ²«çš„å½¢æ€å’ŒåŠ¨ç”»å¯ä»¥é‡‡æ ·ä¸€å¼ å™ªéŸ³å›¾ã€‚

ã€æ€ä¹ˆæ¶ˆé™¤çºµæ·±æ„Ÿã€‘



## Reference

> Outline:
>
> https://github.com/QianMo/Game-Programmer-Study-Notes/tree/master/Content/%E7%9C%9F%E5%AE%9E%E6%84%9F%E6%B0%B4%E4%BD%93%E6%B8%B2%E6%9F%93%E6%8A%80%E6%9C%AF%E6%80%BB%E7%BB%93
>
> ä¸è¦ç”¨switchç©é»‘æ——ï¼Œä¸€ç‚¹æ°´èŠ±éƒ½çœ‹ä¸è§ï¼š
>
> https://www.fxguide.com/fxfeatured/assassins-creed-iii-the-tech-behind-or-beneath-the-action/
>
> æœ‰æ•™æ— ç±»å½“ä»£å­”å­ï¼š
>
> https://catlikecoding.com/unity/tutorials/flow/
>
> å¡é€šæ°´ï¼š
>
> https://roystan.net/articles/toon-water.html
>
> https://lindenreidblog.com/2017/12/15/simple-water-shader-in-unity/
>
> 
>
> ...ï¼š
>
> https://learnopengl-cn.github.io/07%20PBR/01%20Theory/

